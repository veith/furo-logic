<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="forth-stack.html">


<script>
  /**
   * `hp-35`
   * see https://hansklav.home.xs4all.nl/rpn/
   *
   * @customElement
   * @polymer
   * @demo demo/index.html
   */
  class Hp35 extends ForthStack {
    constructor() {
      super();
    }

    static get is() {
      return 'hp-35';
    }

    static get properties() {
      return {
        /**
         * current display / result
         */
        display: {type: Number, value: 0, notify: true}
      }
    }

    /**
     * Enter a number
     * @param n
     */
    enter(n) {
      this.put(parseFloat(n));
      this.set('display', parseFloat(n));
    }

    swap() {
      super.swap();
      this.set('display', this._stack[this._stack.length - 1]);
    }


    rot() {
      super.rot();
      this.set('display', this._stack[this._stack.length - 1]);
      return this._stack[this._stack.length - 1];
    }
    roll() {
      return this.rot();
    }

    /**
     * Process an addition
     * @return Number
     */
    add(n) {
      if (n !== undefined && n !== '') {
        this.enter(n);
      }
      let res = 0;
      if (this.size > 1) {
        res = this.drop() + this.drop();
      } else {
        if (this.size == 1) {
          res = this.drop();
        }
      }
      this.put(res);
      this.set('display', res);
      return res;
    }

    /**
     * Perform square root operation
     */
    sqrt(n){
      if (n !== undefined && n !== '') {
        this.enter(n);
      }
      let res;
      if(this.size >= 1){
        res = Math.sqrt(this.drop());
      }
      this.put(res);
      this.set('display', res);
      return res;
    }

    xroot(n){
      if (n !== undefined && n !== '') {
        this.enter(n);
      }
      let res;
      if(this.size > 1){
        this.swap();
        res = Math.pow(this.drop(), 1/this.drop());
        this.put(res);
        this.set('display', res);
        return res;
      }

    }
    /**
     * Process a multiplication
     * @return Number
     */
    multiply(n) {
      if (n !== undefined && n !== '') {
        this.enter(n);
      }
      let res = 0;
      if (this.size > 1) {
        res = this.drop() * this.drop();
      } else {
        if (this.size == 1) {
          res = 0;
        }
      }
      this.put(res);
      this.set('display', res);
      return res;
    }

    /**
     * Process a division
     * @return Number
     */
    divide(n) {
      if (n !== undefined && n !== '') {
        this.enter(n);
      }
      let res = 0;
      if (this.size > 1) {
        this.swap();
        res = this.drop() / this.drop();
      } else {
        if (this.size == 1) {
          res = 0;
        }
      }
      this.put(res);
      this.set('display', res);
      return res;
    }

    clear() {
      super.clearStack();
    }
  }

  window.customElements.define(Hp35.is, Hp35);

</script>
